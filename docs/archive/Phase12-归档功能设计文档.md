# Phase 12 - å½’æ¡£åŠŸèƒ½è®¾è®¡æ–‡æ¡£

## 1. åŠŸèƒ½æ¦‚è¿°

å½’æ¡£åŠŸèƒ½æ˜¯åšå®¢ç³»ç»Ÿçš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œç”¨äºå±•ç¤ºå’Œç®¡ç†å†å²æ–‡ç« ã€‚å®ƒå…è®¸ç”¨æˆ·é€šè¿‡æ—¶é—´çº¿çš„æ–¹å¼æµè§ˆæ‰€æœ‰å·²å‘å¸ƒçš„æ–‡ç« ï¼ŒæŒ‰å¹´ä»½ã€æœˆä»½è¿›è¡Œåˆ†ç»„å’Œç­›é€‰ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- **æ—¶é—´çº¿å±•ç¤º**: æŒ‰æ—¶é—´é¡ºåºå±•ç¤ºæ‰€æœ‰æ–‡ç« 
- **å¹´æœˆåˆ†ç»„**: æ–‡ç« æŒ‰å¹´ä»½å’Œæœˆä»½è‡ªåŠ¨åˆ†ç»„
- **å¿«é€Ÿå¯¼èˆª**: æ”¯æŒè·³è½¬åˆ°ç‰¹å®šå¹´ä»½æˆ–æœˆä»½
- **ç»Ÿè®¡ä¿¡æ¯**: æ˜¾ç¤ºæ¯ä¸ªæ—¶é—´æ®µçš„æ–‡ç« æ•°é‡
- **å“åº”å¼è®¾è®¡**: é€‚é…å„ç§è®¾å¤‡å±å¹•
- **è¿‘æœŸä¼˜å…ˆ**: é»˜è®¤å±•ç¤ºæœ€è¿‘ 3 å¹´æ•°æ®ï¼Œå…¶ä½™å†…å®¹é€šè¿‡å¯¼èˆªè®¿é—®

## 2. æŠ€æœ¯æ¶æ„

### 2.1 æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Next.js 15.5.0 (App Router)
- **UIç»„ä»¶**: shadcn/ui + Radix UI
- **æ ·å¼**: Tailwind CSS
- **æ•°æ®è·å–**: Server Actions
- **æ•°æ®åº“**: Prisma + PostgreSQL

### 2.2 è·¯ç”±è®¾è®¡

```
/archive                 # å½’æ¡£ä¸»é¡µï¼Œæ˜¾ç¤ºæ‰€æœ‰å¹´ä»½
/archive/[year]         # ç‰¹å®šå¹´ä»½çš„æ–‡ç« 
/archive/[year]/[month] # ç‰¹å®šå¹´æœˆçš„æ–‡ç« 
```

### 2.3 ç»„ä»¶æ¶æ„

```
components/
â”œâ”€â”€ archive/
â”‚   â”œâ”€â”€ archive-timeline.tsx     # æ—¶é—´çº¿ä¸»ç»„ä»¶
â”‚   â”œâ”€â”€ archive-year-group.tsx   # å¹´ä»½åˆ†ç»„ç»„ä»¶
â”‚   â”œâ”€â”€ archive-month-group.tsx  # æœˆä»½åˆ†ç»„ç»„ä»¶
â”‚   â”œâ”€â”€ archive-post-item.tsx    # æ–‡ç« æ¡ç›®ç»„ä»¶
â”‚   â”œâ”€â”€ archive-stats.tsx        # ç»Ÿè®¡ä¿¡æ¯ç»„ä»¶
â”‚   â””â”€â”€ archive-navigation.tsx   # å¯¼èˆªç»„ä»¶
```

## 3. æ•°æ®æ¨¡å‹

### 3.1 æŸ¥è¯¢ä¼˜åŒ–

åˆ©ç”¨ç°æœ‰ Post æ¨¡å‹ï¼Œé€šè¿‡ä¼˜åŒ–æŸ¥è¯¢æ¥è·å–å½’æ¡£æ•°æ®ï¼š

```typescript
interface ArchiveData {
  year: number
  months: {
    month: number
    monthName: string
    count: number
    posts: {
      id: string
      title: string
      slug: string
      publishedAt: Date
      summary?: string
      tags: Tag[]
      readingTime?: number
    }[]
  }[]
  totalCount: number
}
```

### 3.2 æ•°æ®åº“æŸ¥è¯¢ç­–ç•¥

- ä½¿ç”¨ `prisma.$queryRaw` ä¸ `EXTRACT(YEAR/MONTH)` ç›´æ¥åœ¨æ•°æ®åº“ä¾§èšåˆæ–‡ç« æ•°é‡
- èšåˆæ•°æ®é©±åŠ¨åº”ç”¨å±‚ç»„è£…ï¼Œé¿å…é‡å¤éå†æ‰€æœ‰æ–‡ç« åˆ—è¡¨
- é»˜è®¤é™åˆ¶æ—¶é—´çª—å£ä¸ºæœ€è¿‘ 3 å¹´ï¼Œæ˜¾å¼è¯·æ±‚å¹´ä»½/æœˆä»½æ—¶ç²¾ç¡®è¿‡æ»¤
- æ¯ä¸ªè‡ªç„¶æœˆä»…è¿”å›å‰ 5 ç¯‡æ–‡ç« çš„æ•°æ®ï¼Œé€šè¿‡ `count`
  å­—æ®µå‘ŠçŸ¥å®Œæ•´æ•°é‡ï¼›å¦‚éœ€å…¨é‡ï¼Œè°ƒç”¨ `getArchiveData({ perMonthPostLimit: null })`
- é€šè¿‡ `unstable_cache` + `revalidateArchiveCache` ï¼ˆåœ¨ `lib/actions/posts.ts`
  çš„æ–‡ç«  CRUD ä¸­è§¦å‘ `revalidateTag`ï¼‰ä¿æŒç¼“å­˜æ–°é²œ

## 4. API è®¾è®¡

### 4.1 Server Actions

```typescript
// lib/actions/archive.ts

// è·å–å½’æ¡£æ•°æ®
async function getArchiveData(options?: {
  year?: number
  month?: number
  limit?: number
  offset?: number
}): Promise<ArchiveData[]>

// è·å–å¹´ä»½åˆ—è¡¨
async function getArchiveYears(): Promise<
  {
    year: number
    count: number
  }[]
>

// è·å–ç‰¹å®šå¹´ä»½çš„æœˆä»½åˆ—è¡¨
async function getArchiveMonths(year: number): Promise<
  {
    month: number
    count: number
  }[]
>

// è·å–å½’æ¡£ç»Ÿè®¡ä¿¡æ¯
async function getArchiveStats(): Promise<{
  totalPosts: number
  totalYears: number
  oldestPost?: Date
  newestPost?: Date
}>
```

## 5. ç”¨æˆ·ç•Œé¢è®¾è®¡

### 5.1 æ¡Œé¢ç«¯å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å½’æ¡£ - æ–‡ç« æ—¶é—´çº¿            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [2025] [2024] [2023] [å…¨éƒ¨]       â”‚ <- å¹´ä»½å¿«é€Ÿå¯¼èˆª
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æ€»è®¡: 156 ç¯‡æ–‡ç«  | 3 å¹´            â”‚ <- ç»Ÿè®¡ä¿¡æ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“… 2025 å¹´ (45 ç¯‡)                 â”‚
â”‚  â”œâ”€â”€ 1æœˆ (8 ç¯‡)                     â”‚
â”‚  â”‚   â”œâ”€â”€ 01-28 æ–‡ç« æ ‡é¢˜1           â”‚
â”‚  â”‚   â”œâ”€â”€ 01-15 æ–‡ç« æ ‡é¢˜2           â”‚
â”‚  â”‚   â””â”€â”€ 01-03 æ–‡ç« æ ‡é¢˜3           â”‚
â”‚  â”œâ”€â”€ 2æœˆ (12 ç¯‡)                    â”‚
â”‚  â”‚   â”œâ”€â”€ 02-20 æ–‡ç« æ ‡é¢˜4           â”‚
â”‚  â”‚   â””â”€â”€ ...                        â”‚
â”‚  â””â”€â”€ ...                            â”‚
â”‚                                      â”‚
â”‚  ğŸ“… 2024 å¹´ (78 ç¯‡)                 â”‚
â”‚  â”œâ”€â”€ 12æœˆ (10 ç¯‡)                   â”‚
â”‚  â”‚   â””â”€â”€ ...                        â”‚
â”‚  â””â”€â”€ ...                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 ç§»åŠ¨ç«¯å¸ƒå±€

- æŠ˜å å¼å¹´æœˆå¯¼èˆª
- ç®€åŒ–çš„æ–‡ç« åˆ—è¡¨å±•ç¤º
- æ‚¬æµ®çš„"è¿”å›é¡¶éƒ¨"æŒ‰é’®

### 5.3 äº¤äº’è®¾è®¡

- **å±•å¼€/æŠ˜å **: ç‚¹å‡»å¹´ä»½æˆ–æœˆä»½å±•å¼€/æ”¶èµ·æ–‡ç« åˆ—è¡¨
- **å¹³æ»‘æ»šåŠ¨ä¸é™çº§è·³è½¬**: è‹¥ç›®æ ‡å¹´ä»½åœ¨å½“å‰é¡µé¢å­˜åœ¨åˆ™å¹³æ»‘æ»šåŠ¨ï¼Œå¦åˆ™è·³è½¬è‡³å¯¹åº”å¹´ä»½é¡µé¢
- **è¿”å›é¡¶éƒ¨**: é•¿åˆ—è¡¨æä¾›æ‚¬æµ®æŒ‰é’®å¿«é€Ÿå›åˆ°é¡¶éƒ¨
- **æœˆä»½æ·±é“¾**: æœˆä»½ç»„ä»¶æä¾›â€œæŸ¥çœ‹å…¨éƒ¨â€æŒ‰é’®è·³è½¬è‡³å½“æœˆåˆ—è¡¨é¡µ

## 6. æ€§èƒ½ä¼˜åŒ–

### 6.1 æ•°æ®åŠ è½½ç­–ç•¥

- **SSR + æœ€è¿‘ 3 å¹´çª—å£**: é¦–å±æ¸²æŸ“æœ€è¿‘ 3 å¹´æ•°æ®ï¼Œå‡å°‘åˆå§‹è´Ÿè½½
- **ç¼“å­˜ç­–ç•¥**: `unstable_cache` ç¼“å­˜èšåˆç»“æœï¼Œæ–‡ç«  CRUD æ—¶é€šè¿‡
  `revalidateTag('archive')` ç²¾ç¡®å¤±æ•ˆ
- **æ˜¾å¼æŸ¥è¯¢**: æŒ‡å®šå¹´ä»½/æœˆä»½æ—¶æŒ‰æ—¶é—´èŒƒå›´ç²¾ç¡®è¿‡æ»¤ï¼Œé¿å…å…¨è¡¨æ‰«æ

### 6.2 æ¸²æŸ“ä¼˜åŒ–

- **åŠ¨ç”»èŠ‚åˆ¶**: Framer Motion ä»…åœ¨æ ¸å¿ƒç»„ä»¶ä¸­ä½¿ç”¨ï¼Œä¿æŒäº¤äº’é¡ºæ»‘
- **å®¢æˆ·ç«¯é™çº§æ–¹æ¡ˆ**: å½“å¹³æ»‘æ»šåŠ¨ç›®æ ‡ä¸å­˜åœ¨æ—¶è‡ªåŠ¨è·³è½¬å¯¹åº”è·¯ç”±ï¼Œé¿å…ç©ºæ“ä½œ
- **æœªæ¥å¢å¼º**: è™šæ‹Ÿæ»šåŠ¨ã€å®¢æˆ·ç«¯æ‡’åŠ è½½ä¿ç•™è‡³æ•°æ®é‡æ˜¾è‘—å¢é•¿æ—¶å†å¯ç”¨

## 7. SEO ä¼˜åŒ–

### 7.1 Meta æ ‡ç­¾

```typescript
export const metadata = {
  title: "æ–‡ç« å½’æ¡£ | åšå®¢åç§°",
  description: "æµè§ˆæ‰€æœ‰å†å²æ–‡ç« ï¼ŒæŒ‰æ—¶é—´çº¿ç»„ç»‡",
  openGraph: {
    title: "æ–‡ç« å½’æ¡£",
    description: "æ¢ç´¢æˆ‘ä»¬çš„æ–‡ç« æ—¶é—´çº¿",
    type: "website",
  },
}
```

### 7.2 ç»“æ„åŒ–æ•°æ®

æ·»åŠ  Schema.org çš„ CollectionPage ç»“æ„åŒ–æ•°æ®

### 7.3 ç«™ç‚¹åœ°å›¾

åœ¨ sitemap.xml ä¸­åŒ…å«å½’æ¡£é¡µé¢é“¾æ¥

## 8. æ— éšœç¢è®¾è®¡

### 8.1 é”®ç›˜å¯¼èˆª

- Tab é”®éå†æ‰€æœ‰å¯äº¤äº’å…ƒç´ 
- Enter/Space å±•å¼€æŠ˜å å†…å®¹
- æ–¹å‘é”®åœ¨æ–‡ç« é—´å¯¼èˆª

### 8.2 å±å¹•é˜…è¯»å™¨æ”¯æŒ

- é€‚å½“çš„ ARIA æ ‡ç­¾
- è¯­ä¹‰åŒ– HTML ç»“æ„
- æ¸…æ™°çš„æ ‡é¢˜å±‚çº§

### 8.3 è§†è§‰å¢å¼º

- é«˜å¯¹æ¯”åº¦æ¨¡å¼æ”¯æŒ
- ç„¦ç‚¹æŒ‡ç¤ºå™¨æ¸…æ™°å¯è§
- æ”¯æŒç”¨æˆ·åå¥½çš„åŠ¨ç”»è®¾ç½®

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 å•å…ƒæµ‹è¯•

- Server Actions é€»è¾‘æµ‹è¯•
- æ•°æ®è½¬æ¢å‡½æ•°æµ‹è¯•
- å·¥å…·å‡½æ•°æµ‹è¯•

### 9.2 ç»„ä»¶æµ‹è¯•

- å„ç»„ä»¶çš„æ¸²æŸ“æµ‹è¯•
- äº¤äº’è¡Œä¸ºæµ‹è¯•
- å“åº”å¼å¸ƒå±€æµ‹è¯•

### 9.3 E2E æµ‹è¯•

- å®Œæ•´çš„ç”¨æˆ·æµç¨‹æµ‹è¯•
- æ€§èƒ½æµ‹è¯•
- è·¨æµè§ˆå™¨å…¼å®¹æ€§æµ‹è¯•

## 10. å®æ–½è®¡åˆ’

### Phase 1: åŸºç¡€æ¶æ„ (ç¬¬1-2å¤©)

- åˆ›å»ºåŸºæœ¬è·¯ç”±ç»“æ„
- å®ç° Server Actions
- è®¾è®¡åŸºç¡€ç»„ä»¶æ¡†æ¶

### Phase 2: æ ¸å¿ƒåŠŸèƒ½ (ç¬¬3-4å¤©)

- å®ç°æ—¶é—´çº¿å±•ç¤º
- å®Œæˆå¹´æœˆåˆ†ç»„é€»è¾‘
- æ·»åŠ åŸºç¡€äº¤äº’

### Phase 3: å¢å¼ºåŠŸèƒ½ (ç¬¬5-6å¤©)

- æ·»åŠ å¯¼èˆªåŠŸèƒ½
- å®ç°æœç´¢é›†æˆ
- ä¼˜åŒ–æ€§èƒ½

### Phase 4: æµ‹è¯•ä¸ä¼˜åŒ– (ç¬¬7å¤©)

- å®Œæ•´æµ‹è¯•
- æ€§èƒ½ä¼˜åŒ–
- æ–‡æ¡£å®Œå–„

## 11. é£é™©è¯„ä¼°

### æ½œåœ¨é£é™©

1. **æ€§èƒ½é£é™©**: å¤§é‡æ–‡ç« æ—¶çš„åŠ è½½æ€§èƒ½
   - ç¼“è§£æªæ–½: åˆ†é¡µåŠ è½½ã€è™šæ‹Ÿæ»šåŠ¨

2. **å…¼å®¹æ€§é£é™©**: ä¸åŒæµè§ˆå™¨çš„å…¼å®¹æ€§
   - ç¼“è§£æªæ–½: å……åˆ†æµ‹è¯•ã€æ¸è¿›å¢å¼º

3. **æ•°æ®ä¸€è‡´æ€§**: æ–‡ç« æ›´æ–°æ—¶çš„ç¼“å­˜åŒæ­¥
   - ç¼“è§£æªæ–½: åˆç†çš„ç¼“å­˜ç­–ç•¥ã€å³æ—¶æ›´æ–°æœºåˆ¶

## 12. æˆåŠŸæŒ‡æ ‡

- **æ€§èƒ½æŒ‡æ ‡**
  - é¦–å±åŠ è½½æ—¶é—´ < 2ç§’
  - äº¤äº’å“åº”æ—¶é—´ < 100ms
  - Lighthouse åˆ†æ•° > 90

- **ç”¨æˆ·ä½“éªŒæŒ‡æ ‡**
  - ç”¨æˆ·å¹³å‡åœç•™æ—¶é—´æå‡ 20%
  - é¡µé¢è·³å‡ºç‡é™ä½ 15%
  - æ–‡ç« å‘ç°ç‡æå‡ 30%

- **æŠ€æœ¯æŒ‡æ ‡**
  - æµ‹è¯•è¦†ç›–ç‡ > 80%
  - æ— å…³é”® bug
  - ä»£ç è´¨é‡è¯„åˆ† A çº§
