# GEMINI.md - 工作指南 (v4.0)

## 🚨 CRITICAL RULE - 强制语言规则

**必须始终使用中文回答问题和交流**

- 所有解释、说明、思考过程和回复必须使用简体中文
- 代码实体（变量名、函数名、类名）和技术术语保持英文不变

---

本文件为 Gemini 在此“现代化博客与社交动态平台”项目中高效、精准工作提供核心指导。在开始任何工作前，必须熟悉并严格遵守以下核心参考资料中定义的规范。

## 核心参考资料 (Core Reference Documents)

1.  **《现代博客项目架构设计.md
    v4.0》**: 定义了项目的技术栈、版本、数据模型和部署流程。**是所有技术实现的唯一蓝图。**
2.  **《现代化博客需求文档.md
    v4.0》**: 定义了项目的功能范围、用户角色和具体需求。**是所有功能开发的唯一依据。**
3.  **《项目实施路线指南.md v4.0》**: 提供了项目从零到一的宏观步骤和开发方法论。

## 第一部分：核心编程原则 (Guiding Principles)

### 1. 可读性优先 (Readability First)

始终牢记“代码是写给人看的，只是恰好机器可以执行”。清晰度高于一切。

### 2. DRY (Don't Repeat Yourself)

绝不复制代码片段。通过抽象（如函数、类、模块）来封装和复用通用逻辑。

### 3. 高内聚，低耦合 (High Cohesion, Low Coupling)

功能高度相关的代码应该放在一起（高内聚），而模块之间应尽量减少依赖（低耦合），以增强模块独立性和可维护性。

### 4. 避免过度工程化 (Avoid Over-Engineering)

- **核心思想**: 严格遵循已确立的需求范围，解决**当前**的问题，而不是为未来可能出现但尚未存在的问题设计复杂的解决方案。
- **架构设计**: 必须遵循已确立的以 Next.js +
  Supabase 为核心的全栈架构，避免引入不必要的微服务或独立的后端。
- **功能开发**: 严格围绕**“博客模块（单一管理员）”**和**“动态模块（多用户）”**的双核模型进行开发，清晰区分两者权限边界。

### 5. 本地开发优先原则 (Local Development First)

- **核心思想**: 将个人开发的效率和生产环境的稳健性结合起来。本地开发必须优先使用由
  **Supabase CLI** 启动的本地实例。
- **实践要求**:
  - 日常开发必须在本地隔离环境中进行，以获得无网络延迟的流畅体验，并确保生产数据的绝对安全。
  - 所有数据库结构变更，必须先在本地完成，然后通过 `supabase db diff`
    生成迁移文件进行版本控制。

## 第二部分：具体执行指令 (Actionable Instructions)

### 1. 沟通与语言规范

- **默认语言**: 请默认使用**简体中文**进行所有交流、解释和思考过程的陈述。
- **代码与术语**: 所有代码实体（变量名、函数名、类名等）及技术术语（如 Supabase,
  Prisma, Vercel 等）**必须保持英文原文**。

### 2. 批判性反馈与破框思维

- **审慎分析**: 必须以审视和批判的眼光分析您的输入，主动识别与**核心参考资料**的冲突点。
- **坦率直言**: 需要明确、直接地指出您思考中的盲点，特别是当您的指令可能偏离既定技术栈（例如，建议使用 Jest 而非 Vitest）或引入过度工程化时。
- **严厉质询**: 当您提出的想法或方案明显不合理时，必须使用更直接的言辞进行反驳，例如：“这个方案似乎混淆了‘博客’和‘动态’的权限边界，是否需要重新评估？”

### 3. 开发与调试策略

- **坚韧不拔的解决问题**: 当面对编译错误或逻辑不通时，绝不允许通过简化或伪造实现来“绕过”问题。
- **探索有效替代方案**: 如果当前路径确实无法走通，应在**既定技术栈**的框架内探索另一个逻辑完整、功能健全的替代方案来解决问题。
- **禁止伪造实现**: 严禁使用占位符逻辑、虚假数据或不完整的函数来伪装功能已经实现。

## 第三部分：项目架构与工作流强制规定

### 1. 技术栈与版本强制规定

- 所有开发活动都**必须**严格遵守**《现代博客项目架构设计.md》**中定义的技术栈和版本。
- **包管理器**: 本项目**必须使用 pnpm**，严禁使用 npm 或 yarn。

### 2. 数据库与迁移工作流

- **Schema First**: 所有数据库表结构的变更，**必须**首先在
  `prisma/schema.prisma` 文件中进行定义。
- **迁移流程**: 必须遵循以下流程：
  1. 在本地修改 `prisma/schema.prisma`。
  2. 运行 `npx prisma db push` 将变更应用到**本地**数据库。
  3. 运行 `supabase db diff -f "migration_description"`，生成一个 SQL
     **迁移文件**。
  4. 将新生成的迁移文件和代码一起**提交到 Git**。

### 3. 认证与授权逻辑

- **认证入口**: 支持 **GitHub OAuth** 和 **邮箱/密码** 两种认证方式。
- **授权检查**: 所有 Server
  Action 或页面，**必须**在执行核心逻辑前进行严格的权限检查：
  - **博客模块 (文章/系列等)**: 必须检查用户 `role` 是否为 `ADMIN`。
  - **动态模块 (发布/互动等)**: 必须检查用户是否**已登录**且 `status` 为
    `ACTIVE`。
  - **用户管理**: 操作者 `role` 必须为 `ADMIN`。

### 4. 目录结构与代码组织

- 所有新创建的文件，**必须**严格按照**《现代博客项目架构设计.md》**中推荐的目录结构放置。

## 常用开发命令 (Common Development Commands)

### 项目初始化和设置

```bash
# 安装依赖 (使用 pnpm)
pnpm install

# 初始化 Supabase 本地环境
supabase start

# 设置本地数据库 schema
npx prisma db push
```

### 本地开发

```bash
# 启动本地开发服务器
pnpm dev
```

### 数据库管理

```bash
# 修改 schema 后推送到本地数据库
npx prisma db push

# 生成数据库迁移文件
supabase db diff -f "migration_description"

# 重置本地数据库
supabase db reset

# 生成 Prisma 客户端
npx prisma generate
```

### 代码质量和测试

```bash
# 运行所有测试
pnpm test

# 类型检查
pnpm type-check

# 代码格式化与检查
pnpm lint
```
